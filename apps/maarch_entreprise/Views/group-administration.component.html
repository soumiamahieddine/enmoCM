<div class="page-header">
    <h1 *ngIf="!creationMode">{{lang.groupModification}}
        <small>{{group.group_desc}} ({{group.group_id}})</small>
    </h1>
    <h1 *ngIf="creationMode">{{lang.groupCreation}}
        <small>{{group.group_desc}} ({{group.group_id}})</small>
    </h1>
</div>
<div *ngIf="loading">
    <mat-spinner style="margin:auto;"></mat-spinner>
</div>
<div *ngIf="!loading" class="container-fluid">


    <div class="col-md-6">
        <mat-tab-group [(selectedIndex)]="selectedTabIndex_1">
            <mat-tab label="{{lang.informations}}">
                <form class="form-horizontal" (ngSubmit)="onSubmit()" #groupForm="ngForm">
                    <mat-form-field>
                        <input matInput *ngIf="creationMode" name="identifier" placeholder="{{lang.id}}" [(ngModel)]="group.group_id" pattern="^[\w.-]*$" maxlength="32" required>
                        <input matInput *ngIf="!creationMode" name="identifier" placeholder="{{lang.id}}" title="{{lang.id}}" [(ngModel)]="group.group_id" disabled>
                    </mat-form-field>

                    <mat-form-field>
                        <input matInput name="description" title="{{lang.label}}" placeholder="{{lang.label}}" [(ngModel)]="group.group_desc" maxlength="255" required>
                    </mat-form-field>

                    <div class="col-md-12">
                        <mat-form-field>
                            <input matInput name="comment" title="{{lang.description}}" placeholder="{{lang.description}}" [(ngModel)]="group.security.maarch_comment"
                                required>
                        </mat-form-field>
                        <mat-form-field>
                            <textarea matInput name="clause" title="{{lang.clause}}" placeholder="{{lang.clause}}" [(ngModel)]="group.security.where_clause"
                                required matTextareaAutosize matAutosizeMinRows="1" matAutosizeMaxRows="5"></textarea>
                            <mat-icon style="cursor:pointer;" color="primary" matSuffix class="fa fa-info-circle" matTooltip="{{lang.keywordHelper}}"
                                (click)="toggleKeywordHelp()"></mat-icon>
                        </mat-form-field>

                    </div>
                    <div class="col-md-12 text-center" style="padding:10px;">
                        <button mat-raised-button [disabled]="!groupForm.form.valid" color="primary">{{lang.save}}</button>
                        <button mat-raised-button routerLink='/administration/groups'>{{lang.cancel}}</button>
                    </div>
                </form>
            </mat-tab>
            <mat-tab label="{{lang.relatedUsers}}" *ngIf="!creationMode">
                <div class="example-container">
                    <mat-grid-list cols="3" rowHeight="100px">
                        <mat-grid-tile>
                            <mat-paginator #paginator [length]="100" [pageSize]="10">
                            </mat-paginator>
                        </mat-grid-tile>
                        <mat-grid-tile></mat-grid-tile>
                        <mat-grid-tile>
                            <mat-form-field>
                                <input matInput (keyup)="applyFilter($event.target.value)" placeholder="{{lang.filterBy}}">
                            </mat-form-field>
                        </mat-grid-tile>
                    </mat-grid-list>
                    <mat-table #table [dataSource]="dataSource" matSort matSortActive="lastname" matSortDirection="asc">
                        <ng-container matColumnDef="user_id">
                            <mat-header-cell *matHeaderCellDef mat-sort-header>{{lang.id}}</mat-header-cell>
                            <mat-cell *matCellDef="let element"> {{element.user_id}} </mat-cell>
                        </ng-container>
                        <ng-container matColumnDef="firstname">
                            <mat-header-cell *matHeaderCellDef mat-sort-header>{{lang.firstname}}</mat-header-cell>
                            <mat-cell *matCellDef="let element"> {{element.firstname}} </mat-cell>
                        </ng-container>
                        <ng-container matColumnDef="lastname">
                            <mat-header-cell *matHeaderCellDef mat-sort-header>{{lang.lastname}}</mat-header-cell>
                            <mat-cell *matCellDef="let element"> {{element.lastname}} </mat-cell>
                        </ng-container>
                        <ng-container matColumnDef="actions">
                            <mat-header-cell *matHeaderCellDef mat-sort-header></mat-header-cell>
                            <mat-cell *matCellDef="let element">
                                <button mat-icon-button color="primary" matTooltip="{{lang.view}}" routerLink="/administration/users/{{element.id}}">
                                    <mat-icon class="fa fa-eye" aria-hidden="true"></mat-icon>
                                </button>
                            </mat-cell>
                        </ng-container>
                        <mat-header-row *matHeaderRowDef="displayedColumns"></mat-header-row>
                        <mat-row *matRowDef="let row; columns: displayedColumns;"></mat-row>
                    </mat-table>
                </div>
            </mat-tab>
        </mat-tab-group>
    </div>
    <div class="col-md-6">
        <mat-card class="example-card" id="keywordHelp" [ngStyle]="{'display': creationMode ? '' : 'none'}" style="margin-top:10px;position:absolute;z-index:2;">
            <mat-card-header>
                <mat-card-title color="primary" style="font-size: 20px;font-weight: bold;">
                    {{lang.keywordHelp}}
                </mat-card-title>
            </mat-card-header>
            <mat-card-content>
                <mat-list>
                    <mat-list-item style="height:40px;">
                        <h4 mat-line style="font-weight:bold;font-size:10px;">@user :</h4>
                        <p mat-line style="font-size:10px;">{{lang.keywordHelpDesc_1}}</p>
                    </mat-list-item>
                    <mat-list-item style="height:40px;">
                        <h4 mat-line style="font-weight:bold;font-size:10px;">@email :</h4>
                        <p mat-line style="font-size:10px;">{{lang.keywordHelpDesc_2}}</p>
                    </mat-list-item>
                    <mat-list-item style="height:40px;">
                        <h4 mat-line style="font-weight:bold;font-size:10px;">@my_entities :</h4>
                        <p mat-line style="font-size:10px;">{{lang.keywordHelpDesc_3}}</p>
                    </mat-list-item>
                    <mat-list-item style="height:40px;">
                        <h4 mat-line style="font-weight:bold;font-size:10px;">@my_primary_entity :</h4>
                        <p mat-line style="font-size:10px;">{{lang.keywordHelpDesc_4}}</p>
                    </mat-list-item>
                    <mat-list-item style="height:40px;">
                        <h4 mat-line style="font-weight:bold;font-size:10px;">@subentities[('entity_1',...,'entity_n')] :</h4>
                        <p mat-line style="font-size:10px;">{{lang.keywordHelpDesc_5}}</p>
                    </mat-list-item>
                    <mat-list-item style="height:40px;">
                        <h4 mat-line style="font-weight:bold;font-size:10px;">@parent_entity['entity_id'] :</h4>
                        <p mat-line style="font-size:10px;">{{lang.keywordHelpDesc_6}}</p>
                    </mat-list-item>
                    <mat-list-item style="height:40px;">
                        <h4 mat-line style="font-weight:bold;font-size:10px;">@sisters_entities['entity_id'] :</h4>
                        <p mat-line style="font-size:10px;">{{lang.keywordHelpDesc_7}}</p>
                    </mat-list-item>
                    <mat-list-item style="height:40px;">
                        <h4 mat-line style="font-weight:bold;font-size:10px;">@entity_type['type'] :</h4>
                        <p mat-line style="font-size:10px;">{{lang.keywordHelpDesc_8}}</p>
                    </mat-list-item>
                    <mat-list-item style="height:40px;">
                        <h4 mat-line style="font-weight:bold;font-size:10px;">@all_entities :</h4>
                        <p mat-line style="font-size:10px;">{{lang.keywordHelpDesc_9}}</p>
                    </mat-list-item>
                    <mat-list-item style="height:40px;">
                        <h4 mat-line style="font-weight:bold;font-size:10px;">@immediate_children['entity_1',..., 'entity_id'] :</h4>
                        <p mat-line style="font-size:10px;">{{lang.keywordHelpDesc_10}}</p>
                    </mat-list-item>
                </mat-list>
                <p style="font-size:10px;">
                    {{lang.keywordHelpDesc_11}}
                </p>
                <div style="border:1px black solid; padding:3px;font-size:10px;">
                    <b>where_clause : (DESTINATION = @my_primary_entity or DESTINATION in (@subentities[@my_primary_entity]))</b>
                </div>
            </mat-card-content>
        </mat-card>
        <mat-tab-group [(selectedIndex)]="selectedTabIndex_2" *ngIf="!creationMode">
            <mat-tab label="{{lang.menus}}">
                <mat-expansion-panel *ngFor="let upperService of group.services.menu; let i = index">
                    <mat-expansion-panel-header>
                        <mat-panel-title>
                            {{lang[upperService[0]['location']]}}
                        </mat-panel-title>
                    </mat-expansion-panel-header>
                    <mat-list>
                        <mat-list-item *ngFor="let service of upperService">
                            <mat-slide-toggle color="primary" name="{{service.name}}" [checked]="service.checked" [(ngModel)]="service.checked" (change)="updateService(service)"
                                matTooltip="{{service.comment}}">{{service.name}}</mat-slide-toggle>
                        </mat-list-item>
                    </mat-list>
                </mat-expansion-panel>
            </mat-tab>
            <mat-tab label="{{lang.administrationServices}}">
                <mat-expansion-panel *ngFor="let upperService of group.services.administration; let i = index">
                    <mat-expansion-panel-header>
                        <mat-panel-title>
                            {{lang[upperService[0]['location']]}}
                        </mat-panel-title>
                    </mat-expansion-panel-header>
                    <mat-list>
                        <mat-list-item *ngFor="let service of upperService">
                            <mat-slide-toggle color="primary" name="{{service.name}}" [checked]="service.checked" [(ngModel)]="service.checked" (change)="updateService(service)"
                                matTooltip="{{service.comment}}">{{service.name}}</mat-slide-toggle>
                        </mat-list-item>
                    </mat-list>
                </mat-expansion-panel>
            </mat-tab>
            <mat-tab label="{{lang.functionnalities}}">
                <mat-expansion-panel *ngFor="let upperService of group.services.use; let i = index">
                    <mat-expansion-panel-header>
                        <mat-panel-title>
                            {{lang[upperService[0]['location']]}}
                        </mat-panel-title>
                    </mat-expansion-panel-header>
                    <mat-list>
                        <mat-list-item *ngFor="let service of upperService">
                            <mat-slide-toggle color="primary" name="{{service.name}}" [checked]="service.checked" [(ngModel)]="service.checked" (change)="updateService(service)"
                                matTooltip="{{service.comment}}">{{service.name}}</mat-slide-toggle>
                        </mat-list-item>
                    </mat-list>
                </mat-expansion-panel>
            </mat-tab>
        </mat-tab-group>
    </div>
</div>